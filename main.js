(()=>{"use strict";class t{constructor({data:t,userId:e,cardSelector:s,handleImageClick:r,handleTrashClick:i,handleLike:n}){this._data=t,this._userId=e,this._cardSelector=s,this._cardElement=this._getTemplate(),this._handleImageClick=r,this._handleTrashClick=i,this._handleLike=n,this._cardPicture=this._cardElement.querySelector(".card__picture"),this._trashBtn=this._cardElement.querySelector(".card__trash"),this._likeBtn=this._cardElement.querySelector(".card__like-btn"),this._likeQty=this._cardElement.querySelector(".card__like-qty")}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}getId(){return this._data._id}updateLikes(t){this._data=t,this._likeQty.textContent=t.likes.length.toString(),this._likeBtn.classList.toggle("card__like-btn_active")}_setEventListeners(){this._cardElement.querySelector(".card__like-btn").addEventListener("click",(()=>{this._handleLike(this)})),this._data.owner._id===this._userId&&(this._trashBtn.classList.add("card__trash_active"),this._trashBtn.addEventListener("click",(()=>{this._handleTrashClick(this)}))),this._cardPicture.addEventListener("click",(t=>this._handleImageClick(t)))}createCard(){return this._cardPicture.src=this._data.link,this._cardPicture.alt=this._data.name,this._cardElement.querySelector(".card__title").textContent=this._data.name,this._likeQty.textContent=this._data.likes.length.toString(),this._data.likes.some((t=>t._id===this._userId))&&this._likeBtn.classList.add("card__like-btn_active"),this._setEventListeners(),this._cardElement}deleteCard(){this._cardElement.remove(),this._cardElement=null}}class e{constructor(t,e){this._form=e,this._inputSelector=t.inputSelector,this._buttonElement=this._form.querySelector(t.submitButtonSelector),this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}_showInputError(){this._inputElement.classList.add(this._inputErrorClass),this._errorElement.textContent=this._inputElement.validationMessage,this._errorElement.classList.add(this._errorClass)}_hideInputError(){this._inputElement.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}_checkInputValidity(t){this._inputElement=t,this._errorElement=this._form.querySelector(`.${t.id}-error`),this._inputElement.validity.valid?this._hideInputError():this._showInputError()}_hasInvalidInput(){return this._inputList.some((t=>!t.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._inputList.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()}))}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((t=>{this._inputElement=t,this._errorElement=this._form.querySelector(`.${t.id}-error`),this._hideInputError()}))}enableValidation(){this._form.addEventListener("submit",(function(t){t.preventDefault()})),this._setEventListeners()}}class s{constructor(t){this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._popupCloseButton=this._popup.querySelector(".popup__close-button")}_handleEscClose(t){"Escape"===t.key&&this.closePopup()}openPopup(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}closePopup(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popupCloseButton.addEventListener("click",(()=>{this.closePopup()})),this._popup.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&this.closePopup()}))}}class r extends s{constructor({popupSelector:t,submitCallback:e}){super(t),this._submitCallback=e,this._submitForm=this._submitForm.bind(this),this._form=this._popup.querySelector(".popup__form"),this._inputs=Array.from(this._form.querySelectorAll(".popup__field")),this._submitButton=this._form.querySelector(".popup__submit-button")}_getInputValues(){return this._formValues={},this._inputs.forEach((t=>{this._formValues[t.name]=t.value})),this._formValues}closePopup(){super.closePopup(),this._form.reset()}setInputValues(t){this._inputs.forEach((e=>{e.value=t[e.name]}))}_submitForm(){this._submitCallback(this._getInputValues(),this._submitButton)}renderLoading(t="Сохранение..."){this._submitButton.textContent=t}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this._submitForm)}}const i=document.querySelector(".profile__name"),n=document.querySelector(".profile__about"),o=document.querySelector(".profile__avatar"),a=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__avatar-button"),u={};let c;const d=new class{constructor(t){this._baseUrl=t.baseUrl,this._token=t.token}_handlingResponse(t){return t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)}getUserInfo(){return fetch(`${this._baseUrl}users/me`,{headers:{authorization:this._token}}).then((t=>this._handlingResponse(t)))}getInitialCards(){return fetch(`${this._baseUrl}cards`,{headers:{authorization:this._token}}).then((t=>this._handlingResponse(t)))}addUserInfo(t){return fetch(`${this._baseUrl}users/me`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})}).then((t=>this._handlingResponse(t)))}addCard(t){return fetch(`${this._baseUrl}cards`,{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({link:t.link,name:t.name})}).then((t=>this._handlingResponse(t)))}deleteCard(t){return fetch(`${this._baseUrl}cards/${t}`,{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._handlingResponse(t)))}setCardLike(t){return fetch(`${this._baseUrl}cards/${t}/likes`,{method:"PUT",headers:{authorization:this._token}}).then((t=>this._handlingResponse(t)))}removeCardLike(t){return fetch(`${this._baseUrl}cards/${t}/likes`,{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._handlingResponse(t)))}updateAvatar(t){return fetch(`${this._baseUrl}users/me/avatar`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatar})}).then((t=>this._handlingResponse(t)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-39/",token:"e7a7c3fb-6194-4371-9a2c-b0a475e73e1c"});Promise.all([d.getUserInfo(),d.getInitialCards()]).then((([t,e])=>{c=t._id,_.setUserInfo(t),k.renderItems(e)})).catch((t=>console.log(t)));const _=new class{constructor(t,e,s){this._name=t,this._about=e,this._profileAvatar=s}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent}}setUserInfo(t){this._name.textContent=t.name,this._about.textContent=t.about,this._profileAvatar.src=t.avatar}}(i,n,o),p=new r({popupSelector:"#popup-edit",submitCallback:t=>{p.renderLoading(),d.addUserInfo(t).then((t=>{_.setUserInfo(t),p.closePopup()})).catch((t=>console.log(t))).finally((()=>{p.renderLoading("Сохранить")}))}}),m=new r({popupSelector:"#popup-avatar",submitCallback:t=>{m.renderLoading(),d.updateAvatar(t).then((t=>{_.setUserInfo(t),m.closePopup()})).catch((t=>console.log(t))).finally((()=>{m.renderLoading("Сохранить")}))}}),b=new class extends s{constructor(t){super(t),this._picture=this._popup.querySelector(".popup__image"),this._signature=this._popup.querySelector(".popup__signature")}openPopup(t){super.openPopup(),this._picture.src=t.target.src,this._picture.alt=this._signature.textContent=t.target.alt}}("#popup-image"),E=new class extends s{constructor({popupSelector:t,submitCallback:e}){super(t),this._submitCallback=e,this._submitForm=this._submitForm.bind(this),this._form=this._popup.querySelector(".popup__form")}_submitForm(){this._submitCallback(this.data)}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this._submitForm)}}({popupSelector:"#popup-delete",submitCallback:t=>{d.deleteCard(t.getId()).then((()=>{t.deleteCard(),E.closePopup()})).catch((t=>console.log(t)))}}),k=new class{constructor(t,e){this._renderer=t,this._container=document.querySelector(e)}renderItems(t){t.reverse().forEach((t=>{this.render(t)}))}render(t){this.addItem(t)}addItem(t){const e=this._renderer(t);this._container.prepend(e)}}((e=>{const s=function(e){return new t({data:e,userId:c,cardSelector:"#card-template",handleImageClick:t=>b.openPopup(t),handleTrashClick:t=>{E.data=t,E.openPopup()},handleLike:t=>{t._data.likes.some((t=>t._id===c))?d.removeCardLike(t.getId()).then((e=>t.updateLikes(e))).catch((t=>console.log(t))):d.setCardLike(t.getId()).then((e=>t.updateLikes(e))).catch((t=>console.log(t)))}})}(e);return s.createCard()}),".cards"),v=new r({popupSelector:"#popup-add",submitCallback:t=>{v.renderLoading(),d.addCard(t).then((t=>{k.render(t),v.closePopup()})).catch((t=>console.log(t))).finally((()=>{v.renderLoading("Создать")}))}});var f;p.setEventListeners(),v.setEventListeners(),b.setEventListeners(),E.setEventListeners(),m.setEventListeners(),a.addEventListener("click",(()=>{const t=_.getUserInfo();p.setInputValues(t),u.profileForm.resetValidation(),p.openPopup()})),l.addEventListener("click",(()=>{u.addForm.resetValidation(),v.openPopup()})),h.addEventListener("click",(()=>{u.avatarForm.resetValidation(),m.openPopup()})),f={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(f.formSelector)).forEach((t=>{const s=new e(f,t),r=t.getAttribute("name");u[r]=s,s.enableValidation()}))})();